<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Home</title>
</head>
<body>
    <h1>Welcome Home</h1>

    <p th:if="${user != null}">
        Hello, <span th:text="${user.username}"></span>!
    </p>
    <p th:if="${user != null}">
        Hello, <span th:text="${user.id}"></span>!
    </p>

    <a th:href="@{/posts}">ê²Œì‹œê¸€ ëª©ë¡ ë³´ê¸°</a> <!-- ì¶”ê°€ -->

    <br>
    <a th:href="@{/quiz}">ì˜¤í”„ë‹ í€´ì¦ˆ</a>    
    <a th:href="@{/practice}">ì˜¤í”„ë‹ ì—°ìŠµì¥</a>
        
    <a th:href="@{/profile}">ë‚´ í”„ë¡œí•„</a>
    
    <br>
    <a th:href="@{/logout}">Logout</a>

    <div>
        <h2>ğŸ”¥ ì´ë‹¬ì˜ ì¸ê¸° í¬ìŠ¤íŠ¸ (ìµœê·¼ 3ì¼)</h2>
        <ul>
            <li th:each="post : ${topPosts}">
                <a th:href="@{'/posts/' + ${post.id}}" th:text="${post.title}">ì œëª©</a>
                <span> (â™¥ <span th:text="${post.likeCount}"></span>)</span>
            </li>
        </ul>
    </div>    

    <h2>ê²Œì„ë°© ìƒì„±</h2>
    <form action="/chess/room" method="post">
        <input type="text" name="roomName" placeholder="ë°© ì´ë¦„" required />
        <input type="text" name="roomPass" placeholder="ë¹„ë°€ë²ˆí˜¸ (ì„ íƒ)" />
        <input type="hidden" name="hostUserId" th:value="${user.id}" />
        <button type="submit">ë°© ë§Œë“¤ê¸°</button>
    </form>
<h2>ëŒ€ê¸°ì¤‘ì¸ ê²Œì„ë°©</h2>
<div id="waitingRooms"></div>

<script>
    async function loadWaitingRooms() {
        const res = await fetch('/chess/waiting-rooms');
        const rooms = await res.json();

        const container = document.getElementById('waitingRooms');
        container.innerHTML = '';

        if (rooms.length === 0) {
            container.innerHTML = '<p>ëŒ€ê¸° ì¤‘ì¸ ë°©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        rooms.forEach(room => {
            const div = document.createElement('div');
            div.innerHTML = `
                <span>ë°© ì´ë¦„: ${room.roomName}</span>
                <form method="post" action="/chess/room/${room.id}/join" style="display:inline;">
                    <button type="submit">ì°¸ê°€</button>
                </form>
            `;
            container.appendChild(div);
        });
    }

    window.onload = loadWaitingRooms;
</script>



</body>
</html>
